name: Text Snow Rain Matrix

on:
  schedule:
    - cron: "0 7 * * *"
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: Генерация вертикального текстового дождя
        run: |
          echo ""
          echo "==============================="
          echo "    ТЕКСТОВЫЙ СНЕЖНЫЙ ДОЖДЬ"
          echo "==============================="
          echo ""

          # Наборы символов
          SNOW="❄ ✼ ❅ ❆ ✻ ✽ ✵ ✶ ✷ ✸ ⁂ ❇"
          SMALL="· ˑ ː ˘ ˙ ˚ ﾟ ҉ ҈ ❉ ⁎"
          DROP="💧 💦 | ❘ ❙ ⁞ ː ı ֎"
          SHINE="• ⋆ ✧ ✩ ✪ ⁕ ❂ ✿"
          FRACTAL="✣ ✥ ❖ ✢ ✤ ✺ ❁ ❀"

          WIDTH=40
          HEIGHT=50

          for ((i=1; i<=HEIGHT; i++)); do
              LINE=""

              # коэффициент глубины (0..100)
              DEPTH=$(( i * 100 / HEIGHT ))

              # перспектива: шире к низу
              CUR_WIDTH=$(( WIDTH + DEPTH / 6 ))

              # выбор слоя по глубине
              if [ $DEPTH -lt 30 ]; then
                  SET="$SMALL"
                  DENSITY=8
              elif [ $DEPTH -lt 60 ]; then
                  SET="$SMALL $SNOW"
                  DENSITY=5
              elif [ $DEPTH -lt 85 ]; then
                  SET="$SNOW $SHINE"
                  DENSITY=3
              else
                  SET="$SNOW $DROP $FRACTAL"
                  DENSITY=2
              fi

              for ((j=1; j<=CUR_WIDTH; j++)); do
                  if [ $((RANDOM % DENSITY)) -eq 0 ]; then
                      SYMBOL=$(echo "$SET" | tr " " "\n" | shuf -n 1)

                      # капля в полёте (ближний план)
                      if [ $DEPTH -gt 70 ] && [ $((RANDOM % 25)) -eq 0 ]; then
                          SYMBOL=$(echo -e "⋰⋰💧\n⋱⋱💧\n︵︵💧" | shuf -n 1)
                      fi
                  else
                      SYMBOL=" "
                  fi

                  LINE="$LINE$SYMBOL"
              done

              echo "$LINE"
              sleep 0.05
          done

          echo ""
          echo "=========  END  =========="
